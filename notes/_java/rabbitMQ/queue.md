## 相关概念
- 交换器 `exchange`
    - `direct` `fanout` `topic` `headers`
- 队列 `queue` 存储消息
- 路由键 `routingKey`
    - 用于绑定队列和交换器
- 绑定键 `bindingKey`

### 发送消息
- 生产者将消息发送到exchange(交换器)，由exchange将消息路由到一个或者多个队列中，如果路由不到，或许会返回给生产者，或许会直接丢弃

**所以，在发送消息时，可以不定义队列，只需要定义交换器，并且在发送消息时指定路由键(用于接收方绑定队列)**

_如果在发送消息时，没有绑定队列，又没有相应的消费方，则可能直接丢弃消息，在mq中就会看不到发送的相应消息_

### 接收消息
- 消费者向RabbitMQ Broker请求消费相应队列中的消息，可能会设置相应的回调函数，以及做一些准备工作

**在接收/拉取消息时，需要定义exchange、queue、routingKey，来消息对应队列的消息**

# MQTT

## 发布消息(publish)
- 在mqtt连接时，会默认创建`amq.topic`的交换器
- 然后消息发送到`MQ broker`，由`amq.topic`路由到对应的队列中，如果没有订阅方，丢弃消息

### 参数
- `clentId` 对应的队列名称，只有在评阅时才会创建
- `topic` 和`amq.topic`交换器的路由键

## 订阅消息(subscribe)
- 在`mqtt`连接时，会默认创建`amq.topic`的交换器
- 在订阅时，创建名称为`clentId`的队列，在通过名称为`topic`的路由键绑定队列(`clentId_queue`)和交换器(`amq.topic`)
- 当消息到达`MQ broker`，同`amq.topic`路由到对应的队列中
- 消息到达

**因为`clentId`为队列名称，当创建mqtt连接时，如果`clentId`相同，会导致挤掉另外一个连接，可能是每个队列只允许有一个连接**

_clentId创建mqtt连接的唯一标识_

**另外，如果服务器重连，客户端会接收不到消息，也必须重连**

### bug
- 客户端启动订阅后，只能收到第一条消息，后续消息都收不到
    - 原因，在接收消息回调中，又打开一个mqtt连接，测试接收消息，导致通道堵塞，应该启动线程
